query Script($namespace: String, $name: String!) {
  script(namespace: $namespace, name: $name) {
    ...ScriptFields
  }
}

query Scripts {
  currentUser {
    namespace {
      ...NamespaceFields
    }
    teamMemberships {
      team {
        namespace {
          ...NamespaceFields
        }
      }
    }
  }
}

fragment NamespaceFields on Namespace {
  username
  scripts {
    ...ScriptFields
  }
}

fragment AstNode on IScriptAstNode {
  __typename
  type
  ... on ScriptAstParameter {
    name
  }
  ... on ScriptAstText {
    text
  }
}

fragment Parameter on ScriptParameter {
  type
  name
  displayName
  description
  required
  text {
    placeholder
  }
  checkbox {
    falseToggleDisplay
    falseValueSubstitution
    trueToggleDisplay
    trueValueSubstitution
  }
  selector {
    generators {
      named {
        name
      }
      shellScript {
        script
        astTree {
          ...AstNode
        }
      }
      type
    }
    placeholder
    suggestions
    allowRawTextInput
    multi
  }
  path {
    extensions
    fileType
  }
  commandlineInterface {
    required
    short
    long
    requireEquals
    raw
    type {
      __typename
      ... on ScriptParameterCommandlineInterfaceBoolean {
        type
        booleanDefault: default
      }
      ... on ScriptParameterCommandlineInterfaceString {
        type
        stringDefault: default
      }
    }
  }
}

fragment Step on IScriptStep {
  __typename
  type
  ... on ScriptCodeBlockStep {
    name
    codeBlockData {
      runtime
      text
    }
    astTree {
      ...AstNode
    }
  }
  ... on ScriptInputsStep {
    name
    parameters {
      ...Parameter
    }
  }
}

fragment ScriptFields on Script {
  uuid
  name
  namespaceName
  updatedAt
  fields {
    displayName
    description
    templateVersion
    tags
    ruleset {
      or {
        specifier
        key
        value
        inverted
        predicate
      }
    }
    invocationCollection {
      disabled
      inputs
      stdout
      stderr
    }
    steps {
      ...Step
    }
  }
  lastInvokedAt
  lastInvokedAtByUser
  isOwnedByCurrentUser
  shouldCache
}
